
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <!--The viewport meta tag is used to improve the presentation and behavior of the samples 
      on iOS devices-->
     <!--<meta name="viewport" content="initial-scale=1.0; maximum-scale=1.0; user-scalable=yes; width=device-width;" >-->
     
    <title>Financial Model</title>
      <link href="assets/styles.css" rel="stylesheet" />
      <script src="assets/prettify.js"></script>
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>

    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
    <script src="assets/treatment_styles.js" charset="utf-8"></script>
    <script>
    $(document).ready(function () {
        var data;
        var commas = d3.format("0,000");
        var horizon = 50;
        var tooltip = d3.select("#app-container")
            .append("div")
            .attr('class', 'tooltip')
            .style("position", "absolute")
            .style("z-index", "10")
            .style("visibility", "hidden");
        var toolIcon = tooltip.append('img').attr('class', 'toolIcon');
        var toolText = tooltip.append('p').attr('class', 'toolText');

        $('#userInput').keyup(function (event) {
            if (event.keyCode == 13) {
                $("#submitter").click();
            }
        });

        $("#submitter").on('click', function () {
            document.getElementById('home-container').style.display = 'none';
            document.getElementById('home-container').className = 'container';
            document.getElementById('treatmentInput-container').style.display = 'block';
            document.getElementById('treatmentInput-container').className = 'container showing';
            document.getElementById('buttons').style.display = 'block';
            var thisScenario = document.getElementById('userInput').value;
            $.ajax({
                type: "GET",
                url: "http://www.cch2o.org/FinancialModel/financial.php?id=" + thisScenario,
                dataType: "json",
                success: function (json) {
                    console.log(json)
                    var d = buildDataJson(json);
                    getScenarioInfo(json,thisScenario);
                    console.log(d)
                    buildCharts(d.Treatments.length,d.Towns.length);
                    buildWhoPaysTable();
                    buildSplitsTable(d.Towns);
                    buildTreatmentTable(json.Treatments);
                    getIcons(json.Treatments);
                    simIconClick(0);
                   // console.log(data);
                },
                //error:
            })//ajax
        })//submitter on click

        $("#rightBtn").on('click', function () {
            var showing = $('.container.showing');
            var next = showing.next('.container');
            var following = showing.nextAll('.container').length;

            if (next.length > 0) {
                next.addClass('showing').css('display','block')
                showing.removeClass('showing').css('display', 'none')
                $('#leftBtn').css('display', 'block');
            }
            if (following == 1) {
                $(this).css('display', 'none')
            }
        })

        $("#leftBtn").on('click', function () {
            var showing = $('.container.showing');
            var prev = showing.prev('.container');
            var preceeding = showing.prevAll('.container').length

            if (prev.length > 0) {
                prev.addClass('showing').css('display', 'block')
                showing.removeClass('showing').css('display', 'none')
                $('#rightBtn').css('display', 'block');
            }
            if (preceeding == 1) {
                $(this).css('display', 'none')           
            }
        })

        function getScenarioInfo(json,thisScenario) {
            var embayment = json.Splits.EMBAY_DISP;
            var subembayment = json.Splits.SUBEM_DISP;
            var div = document.getElementById('scenarioInfo');
            div.innerHTML = "<strong>Scenario " + thisScenario+"</strong><br>" + "Embayment: " + embayment+"<br>" + "Subembayment: " + subembayment;
        }

        function getIcons(treatments) {
            var scenarioIcons = document.getElementById('scenarioIcons');
            var innerDiv = document.createElement('div')
            innerDiv.setAttribute("id", "innerDiv");
            
            scenarioIcons.innerHTML = '';
            for (var i = 0; i < treatments.length; i++) {
                var div = document.createElement('div');
                div.className = 'scenarioIcon';
                div.style.backgroundImage = 'url(TreatIcons/' + treatmentStyles[treatments[i].tName].icon + ')';
                div.onclick = iconClick;
                innerDiv.appendChild(div);
            }

            if (treatments.length > 5) {
                buildScroll();
            }
            scenarioIcons.appendChild(innerDiv);
        }

        function buildCharts(length,townnumber) {
            document.getElementById('graphs').innerHTML = '';
            var graphSVG = d3.select('#graphs').append('svg').attr('width', '350px').attr('height', '250px')
            chart = graphSVG.append('g').attr('width', chartW).attr('height', chartH);
            rectangles = chart.selectAll('.treatment').data(d3.range(length)).enter().append('rect').attr('class', 'treatment').style('stroke', 'none');
            rectangles.append('svg:title');
            lineGraph = graphSVG.append('g').attr('width', chartW).attr('height', chartH).style('border', '1px solid orange')
                .attr('transform','translate(0,'+chartH+')');
            line = lineGraph.append('svg:path').attr('class', 'mainline line');
                line.append('svg:title');

            for (i = 0; i < townnumber; i++) {
                townlines[i] = lineGraph.append('svg:path').attr('class', 'townline line').style('display', 'none')
                townlines[i].append('svg:title');
            }

            affordline = lineGraph.append('svg:path').attr('class', 'affordline').style('stroke', 'red');
            yAxis = d3.svg.axis().orient("left").tickFormat(d3.format("s")).ticks(3);
            lineGraph.append('svg:g').attr('transform', 'translate(' + margins.left + ',0)').attr('class', 'yaxis')

            T5replaceline = lineGraph.append('svg:path').attr('class', 'T5replaceline').style('stroke', 'blue');
            yAxis = d3.svg.axis().orient("left").tickFormat(d3.format("s")).ticks(3);
            lineGraph.append('svg:g').attr('transform', 'translate(' + margins.left + ',0)').attr('class', 'yaxis')

            xAxis = d3.svg.axis().orient("top").tickFormat(d3.format("g")).ticks(6)
            //lineGraph.append('svg:g').attr('transform', 'translate(0,' + margins.top + ')').attr('class', 'xaxis')

            ticks = graphSVG.append('g').attr('class', 'ticks')
            
            var range = d3.range(0, horizon, 5)
            range.shift();
            ticks.selectAll('.tick').data(range).enter().append('line').attr('class', 'tick').style('stroke', 'black').style('stroke-width', 0.2)
            ticks.append('svg:g').attr('transform', 'translate(0,' + (margins.top + chartH) + ')').attr('class', 'xaxis')

            var graphDiv = document.getElementById('graphs');
            var table = document.createElement('table');
            table.className = 'graphTable';
            var row1 = table.insertRow();
            var title1 = row1.insertCell();
            title1.className = 'cellT';
            title1.innerHTML = "Who Pays";
            var value1 = row1.insertCell();
            value1.className = 'cellV';

            var select = document.createElement('select');
            select.className = 'graphSelect';
            var option0 = document.createElement('option');
            option0.text = "Everybody";
            option0.value =5;
            select.add(option0);
            var option1 = document.createElement('option');
            option1.text = "All Towns";
            option1.value = 0;
            select.add(option1);
            var option3 = document.createElement('option');
            option3.text = "Watershed";
            option3.value = 1;
            select.add(option3);
            var option5 = document.createElement('option');
            option5.text = "Regional";
            option5.value = 2;
            select.add(option5);
            var option6 = document.createElement('option');
            option6.text = "State Grant";
            option6.value = 3;
            select.add(option6);
            var option7 = document.createElement('option');
            option7.text = "Federal Grant";
            option7.value = 4;
            select.add(option7);
            select.onchange =updateWhoPaysGraph;
            value1.appendChild(select);

            var row2 = table.insertRow();
            var title2 = row2.insertCell();
            title2.innerHTML = "Ann. Affordability";
            title2.className = 'cellT';
            var value2 = row2.insertCell();
            value2.className = 'cellV';
            var input = document.createElement('input');
            input.type = "number";
            input.value = 1210;
            input.onchange = updateWhoPaysGraph;
            input.className = 'afford';
            value2.appendChild(input);

            var row3 = table.insertRow();
            var title3 = row3.insertCell();
            title3.innerHTML = "Ann. T5 Replacement Cost";
            title3.className = 'cellT';
            var value3 = row3.insertCell();
            value3.className = 'cellV';
            var input = document.createElement('input');
            input.type = "number";
            input.value = 1250;
            input.onchange = updateWhoPaysGraph;
            input.className = 'T5';
            value3.appendChild(input);

            graphDiv.appendChild(table);

        }

        function buildScroll() {
            var scenarioIcons = document.getElementById('scenarioIcons');
            var down = document.createElement('div');
            down.className = 'scroll down';
            down.onmousedown = scrollDown;
            scenarioIcons.appendChild(down);
            var up = document.createElement('div');
            up.className = 'scroll up';
            up.style.display = 'none';
            up.onmousedown = scrollUp;
            scenarioIcons.appendChild(up);
        }

        function scrollDown() {
            var iconSetH = $('#scenarioIcons').height();
            var innerDivH = $('#innerDiv').height();
            var curr = parseInt($('#innerDiv').css('margin-top'));
            var scroll = (curr - iconSetH + 5);
            $('#innerDiv').animate({ marginTop: scroll + 'px' })
            var nextScroll = (scroll - iconSetH + 5)*(-1);
            if (nextScroll >= innerDivH) {
                $('.scroll.down').css('display', 'none');
            }
            $('.scroll.up').css('display', 'block');
        }
        function scrollUp() {
            var iconSetH = $('#scenarioIcons').height();
            var innerDivH = $('#innerDiv').height();
            var curr = parseInt($('#innerDiv').css('margin-top'));
            var scroll = (curr + iconSetH - 5);
            $('#innerDiv').animate({ marginTop: scroll+'px' })
            var nextScroll = (scroll + iconSetH - 5) * (-1);
            if (nextScroll < 0) {
                $('.scroll.up').css('display', 'none');
            }
            $('.scroll.down').css('display', 'block');
        }

        function iconClick() {
            var index = $(this).index()
            $('.scenarioIcon').removeClass('active');
            $(this).addClass('active')
            document.getElementById('treatmentInputs').innerHTML = '';
            document.getElementById('treatmentInputs').appendChild(generateInputs(index));
        }

        function simIconClick(index) {
            $('.scenarioIcon').removeClass('active');
            $('.scenarioIcon:eq('+index+')').addClass('active')
            document.getElementById('treatmentInputs').innerHTML = '';
            document.getElementById('treatmentInputs').appendChild(generateInputs(index));
        }

        function generateInputs(index) {
            var row = document.getElementsByClassName('treatRow')[index];

            var name = $(row).children('td')[0].innerHTML;
            var initialCap = $(row).children('.CapCost').children('input').val();
            var capFinance = $(row).children('.CapFinance').children('select')[0].selectedIndex;
            var totalCap = $(row).children('.TotalCapCost').children('input').val();
            var startY = parseInt($(row).children('.Years').children('input.start').val());
            var endY = parseInt($(row).children('.Years').children('input.end').val());
            var years = [startY, endY];
            var monitoring = $(row).children('.Monitoring').children('input').val();
            var totalOM = $(row).children('.TotalOM').children('input').val();
            var totalCost = $(row).children('.TotalTech').children('input').val();
            var whoPays = $(row).children('.WhoPays').children('select')[0].selectedIndex;

            var items = [name, initialCap, capFinance, totalCap, years, monitoring, totalOM, totalCost, whoPays];

            return buildSnapshot(items, index);
        }

        function buildSnapshot(items, index) {

            var quickTable = document.createElement('div');
            quickTable.className = 'quickTable row'+index;

            var name = document.createElement('p');
            name.innerHTML = items[0];
            name.className = 'name';
            quickTable.appendChild(name);

            var innerTable = document.createElement('table');
            innerTable.className = 'innerTable';

            var initCapR = innerTable.insertRow();
            var initCapT = initCapR.insertCell();
            initCapT.className = 'cellT'
            initCapT.innerHTML = 'Ann. Capital Cost:';
            var initCapV = initCapR.insertCell();
            initCapV.className = 'cellV'
            initCapV.innerHTML = '$' + ((items[1] == 'null') ? 0 : commas(d3.round(items[1])));

            var capFinR = innerTable.insertRow();
            var capFinT = capFinR.insertCell();
            capFinT.className = 'cellT';
            capFinT.innerHTML = 'Capital Financing:';
            var capFinV = capFinR.insertCell();
            capFinV.className = 'cellV';
            var financeOptions = buildFinancing();
            financeOptions.selectedIndex = items[2];
            financeOptions.onchange = userChangeFinance;
            capFinV.appendChild(financeOptions);

            var totalCapR = innerTable.insertRow();
            var totalCapT = totalCapR.insertCell();
            totalCapT.className = 'cellT';
            totalCapT.innerHTML = 'Ann. Capital<br>Cost + CF:';
            var totalCapV = totalCapR.insertCell();
            totalCapV.className = 'cellV';
            totalCapV.innerHTML = '$' + ((items[3] == 'null') ? 0 : commas(d3.round(items[3])));

            var yearsR = innerTable.insertRow();
            var yearsT = yearsR.insertCell();
            yearsT.className = 'cellT';
            yearsT.innerHTML = 'Years Implemented:';
            var yearsV = yearsR.insertCell();
            yearsV.className = 'cellV';
            var yearsInput = buildYearsSlider();
            $(yearsInput).slider("option", "values", items[4]);
            $(yearsInput).slider("option", "stop", userChangeSlider);
            $(yearsInput).children(".ui-slider-handle")[0].innerHTML = items[4][0];
            $(yearsInput).children(".ui-slider-handle")[1].innerHTML = items[4][1];
            yearsV.appendChild(yearsInput);

            var monitoringR = innerTable.insertRow();
            var monitoringT = monitoringR.insertCell();
            monitoringT.className = 'cellT';
            monitoringT.innerHTML = 'Ann. Monitoring Cost:';
            var monitoringV = monitoringR.insertCell();
            monitoringV.className = 'cellV';
            monitoringV.innerHTML = '$';
            var monitoringInput = document.createElement('input');
            monitoringInput.className = 'mon';
            monitoringInput.value = items[5];
            monitoringInput.type = "number";
            monitoringInput.onchange = userChangeMonitoring;
            monitoringV.appendChild(monitoringInput);

            var totalOMR = innerTable.insertRow();
            var totalOMT = totalOMR.insertCell();
            totalOMT.className = 'cellT';
            totalOMT.innerHTML = 'Ann. OM Cost:';
            var totalOMV = totalOMR.insertCell();
            totalOMV.className = 'cellV';
            totalOMV.innerHTML = '$' + ((items[6] == 'null') ? 0 : commas(d3.round(items[6])));

            var totalTechR = innerTable.insertRow();
            var totalTechT = totalTechR.insertCell();
            totalTechT.className = 'cellT';
            totalTechT.innerHTML = 'Ann. Tech Cost:';
            var totalTechV = totalTechR.insertCell();
            totalTechV.className = 'cellV';
            totalTechV.innerHTML = '$' + ((items[7] == 'null') ? 0 : commas(d3.round(items[7])));

            var whoPaysR = innerTable.insertRow();
            var whoPaysT = whoPaysR.insertCell();
            whoPaysT.className = 'cellT';
            whoPaysT.innerHTML = 'Who Pays:';
            var whoPaysV = whoPaysR.insertCell();
            whoPaysV.className = 'cellV';
            var whoPaysOptions = buildWhoPays();
            whoPaysOptions.selectedIndex = items[8];
            whoPaysOptions.onchange = userChangeWhoPays;
            whoPaysV.appendChild(whoPaysOptions);

            quickTable.appendChild(innerTable);
            return quickTable;
        }

        function userChangeFinance(e) {
            var rowIndex = parseInt($(this).closest('.quickTable')[0].classList[1].split("row")[1]);
            var selIndex = $(this)[0].selectedIndex;
            var row = document.getElementsByClassName('treatRow')[rowIndex];
            $(row).children('.CapFinance').children('select')[0].selectedIndex = selIndex;
            $row = $(row);
            updateTotalCapCost2($row,rowIndex);
        }
        function userChangeWhoPays(e) {
            var rowIndex = parseInt($(this).closest('.quickTable')[0].classList[1].split("row")[1]);
            var selIndex = $(this)[0].selectedIndex;
            var row = document.getElementsByClassName('treatRow')[rowIndex];
            $(row).children('.WhoPays').children('select')[0].selectedIndex = selIndex;
            calculateCostSplits();
        }
        function userChangeSlider(e, ui) {
            var rowIndex = parseInt($(this).closest('.quickTable')[0].classList[1].split("row")[1]);
            var values = ui.values;
            var row = document.getElementsByClassName('treatRow')[rowIndex];
            $(row).children('.Years').children('input.start').val(values[0]);
            $(row).children('.Years').children('input.end').val(values[1]);
            $row = $(row);
            updateTotalOMCost2($row, rowIndex);
        }
        function userChangeMonitoring(e) {
            var rowIndex = parseInt($(this).closest('.quickTable')[0].classList[1].split("row")[1]);
            var value = $(this).val();
            var row = document.getElementsByClassName('treatRow')[rowIndex];
            $(row).children('.Monitoring').children('input').val(value);
            $row = $(row);
            updateTotalOMCost2($row,rowIndex);
        }

        function buildDataJson(json) {
            var splits = json.Splits;
            //HARDCODED HOUSEHOLD COUNTS HERE, INDEX2
            var percentages = [
                [splits.Barnstable, "Barnstable", 27180],
                [splits.Bourne, "Bourne",11028],
                [splits.Brewster, "Brewster",7822],
                [splits.Chatham, "Chatham",7304],
                [splits.Dennis, "Dennis",15467],
                [splits.Eastham, "Eastham",5725],
                [splits.Falmouth, "Falmouth",22039],
                [splits.Harwich, "Harwich",9915],
                [splits.Mashpee, "Mashpee",9866],
                [splits.Orleans, "Orleans",5111],
                [splits.Provincetown, "Provincetown",4300],
                [splits.Sandwich, "Sandwich",9426],
                [splits.Truro, "Truro",3249],
                [splits.Wellfleet, "Wellfleet",4606],
                [splits.Yarmouth, "Yarmouth",17448]
            ];

            for (var i = percentages.length - 1; i >= 0; i--) {
                if (percentages[i][0] == 0) {
                    percentages.splice(i, 1);
                }
            }
            var t = [];
            var townSum = 0;
            for (var i = 0; i < percentages.length; i++) {
                t[i] = { town: percentages[i][1], split: percentages[i][0], households: percentages[i][2] }
                townSum += percentages[i][2];
            }

            var treats = [];
            for (var i = 0; i < json.Treatments.length; i++) {
                treats[i] = { NReduction: json.Treatments[i].NReduction, name: json.Treatments[i].tName, color: treatmentStyles[json.Treatments[i].tName].color }
            }

            data = {};
            data.Treatments = treats;//json.Treatments;
            data.Towns = t;
            data.Payers = Array(5);
            data.Counts = { InEmbay: json.Embayment, InSub: json.Subembayment, TownsAll:townSum };

            return data;
        }//buildDataJson

        function buildTreatmentTable(treatments) {
            var headers = "<tr><th>Treatment</th><th>Annual Capital Cost</th><th>Capital Financing</th><th>Total Annual Capital Cost</th><th>Years Implemented</th><th>Annual Monitoring Cost</th><th>Total Annual OM Cost</th><th>Total Annual Cost of Technology</th><th>Who Pays</th></tr>"
            document.getElementById('mainTable').innerHTML = headers;

            for (var i = 0; i < treatments.length; i++) {
                buildTreatmentRow(treatments[i]);
            };
            calculateCostSplits();
        }//build treatment table

        function buildTreatmentRow(treatment) {
            var row = document.getElementById('mainTable').insertRow();
            row.className = 'treatRow';

            var name = row.insertCell(0);
            //name.innerHTML = treatment.tName;
            name.innerHTML = treatmentStyles[treatment.tName].name;

            var CapCost = row.insertCell(1);
            CapCost.className = "CapCost";
            var CapCostInput = document.createElement('input');
            CapCostInput.setAttribute('value', treatment.Costs.CapCost);
            CapCostInput.style.display = 'none';
            CapCost.appendChild(CapCostInput);
            var CapCostDisplay = document.createElement('span');
            CapCostDisplay.innerHTML = commas(d3.round(treatment.Costs.CapCost, 2));
            CapCost.appendChild(CapCostDisplay);

            var CapFinance = row.insertCell(2);
            CapFinance.className = "CapFinance";
            var financeOptions = buildFinancing();
            financeOptions.onchange = updateTotalCapCost;
            CapFinance.appendChild(financeOptions);

            var TotalCapCost = row.insertCell(3);
            TotalCapCost.className = "TotalCapCost";
            var TotalCapCostInput = document.createElement('input');
            TotalCapCostInput.style.display = 'none';
            TotalCapCost.appendChild(TotalCapCostInput);
            var TotalCapCostDisplay = document.createElement('span');
            TotalCapCost.appendChild(TotalCapCostDisplay);

            calculateTotalCapCost(row);

            var Years = row.insertCell(4);
            Years.className = 'Years';
            var startYInput = document.createElement('input');
            startYInput.className = 'start';
            startYInput.value = 0;
            startYInput.onchange = updateTotalOMCost;
            Years.appendChild(startYInput);
            var endYInput = document.createElement('input');
            endYInput.className = 'end';
            endYInput.value = 20;
            endYInput.onchange = updateTotalOMCost;
            Years.appendChild(endYInput);         

            var Monitoring = row.insertCell(5);
            Monitoring.className = 'Monitoring';
            var MonitoringInput = document.createElement('input');
            MonitoringInput.value = 0;
            Monitoring.appendChild(MonitoringInput);
            MonitoringInput.onchange = updateTotalOMCost;

            var TotalOM = row.insertCell(6);
            TotalOM.className = 'TotalOM';
            var TotalOMInput = document.createElement('input');
            TotalOMInput.setAttribute('om', treatment.Costs.OMCost);
            TotalOMInput.style.display = 'none';
            TotalOM.appendChild(TotalOMInput);
            var TotalOMDisplay = document.createElement('span');
            TotalOM.appendChild(TotalOMDisplay);

            calculateTotalOMCost(row);

            var TotalTechCost = row.insertCell(7);
            TotalTechCost.className = 'TotalTech';
            var TotalTechInput = document.createElement('input');
            TotalTechInput.style.display = 'none';
            TotalTechCost.appendChild(TotalTechInput);
            var TotalTechDisplay = document.createElement('span');
            TotalTechCost.appendChild(TotalTechDisplay);

            calculateTotalTechCost(row);

            var WhoPays = row.insertCell(8);
            WhoPays.className = 'WhoPays';
            var whoPaysOptions = buildWhoPays();
            whoPaysOptions.onchange = calculateCostSplits;
            WhoPays.appendChild(whoPaysOptions);
        }//build treatment row

        function buildFinancing(){
            var select = document.createElement('select');
            select.className = 'FinSelect';
            var option1 = document.createElement('option');
            option1.text = "SRF: 0% for 30 yrs";
            option1.value = 1;
            select.add(option1);
            var option2 = document.createElement('option');
            option2.text = "SRF: 2% for 30 yrs";
            option2.value = 1.02;
            select.add(option2);
            var option3 = document.createElement('option');
            option3.text = "USDA";
            option3.value = 1.05;
            select.add(option3);
            var option4 = document.createElement('option');
            option4.text = "Conventional Financing";
            option4.value = 1.05;
            select.add(option4);
            var option5 = document.createElement('option');
            option5.text = "No Financing";
            option5.value = 1;
            select.add(option5);

            return select;

        }//build financing option dropdown

        function buildYearsSlider() {
            var range = document.createElement('div')
            range.className = 'slider';
            $(range).slider({
                max:horizon,
                min: 0,
                range: true,
                step: 1,
                slide: function (e, ui) {
                    //this function prevents start and end year from being the same, enables dragging of
                    //range when threshold is met
                    if (ui.value < ui.values[1] && ui.values[1] - ui.value > 20) {
                        var values = [ui.value, (ui.value + 20)]
                        ui.values[1] = ui.value + 20;
                        $(this).slider('option', 'values', values);
                    }
                    if (ui.value > ui.values[0] && ui.value - ui.values[0] > 20) {
                        var values = [(ui.value - 20), ui.value]
                        ui.values[0] = ui.value - 20;
                        $(this).slider('option', 'values', values);
                    }
                    if (ui.values[1] - ui.values[0] < 1 || ui.values[1] - ui.values[0] > 20) {
                        return false;
                    }
                    $(".ui-slider-handle")[0].innerHTML = ui.values[0];
                    $(".ui-slider-handle")[1].innerHTML = ui.values[1];
                }
            });            
            return range;
        }

        function buildWhoPays(){
            var select = document.createElement('select');
            var option1 = document.createElement('option');
            option1.text = "Town User: Fee";
            option1.value = 0;
            select.add(option1);
            var option2 = document.createElement('option');
            option2.text = "Town User: Property Tax";
            option2.value = 0;
            select.add(option2);
            var option3 = document.createElement('option');
            option3.text = "Watershed User: Betterment";
            option3.value = 1;
            select.add(option3);
            var option4 = document.createElement('option');
            option4.text = "Watershed User: Fee";
            option4.value = 1;
            select.add(option4);
            var option5 = document.createElement('option');
            option5.text = "Regional User: Fee";
            option5.value = 2;
            select.add(option5);
            var option6 = document.createElement('option');
            option6.text = "State Grant";
            option6.value = 3;
            select.add(option6);
            var option7 = document.createElement('option');
            option7.text = "Federal Grant";
            option7.value = 4;
            select.add(option7);

            return select;

        }//build who pays dropdown

        function buildWhoPaysTable() {
            document.getElementById('totalCosts').innerHTML = '';
            var who = [['Total Annual Cost to All Towns', 'allTowns'],
                        ['Total Annual Cost to Watershed', 'watershed'],
                        ['Total Annual Cost to Region', 'region'],
                        ['State Grants', 'state'],
                        ['Federal Grants', 'federal']];

            for (var i = 0; i < who.length; i++) {
                var row = document.getElementById('totalCosts').insertRow();
                row.className = 'costRow';

                var name = row.insertCell(0);
                name.innerHTML = who[i][0];

                var cost = row.insertCell(1);
                cost.className = 'cost ' + who[i][1];
                var costInput = document.createElement('input');
                costInput.style.display = 'none';
                cost.appendChild(costInput);
                var costDisp = document.createElement('span');
                cost.appendChild(costDisp);
            }
        }//build WhoPays table

        function buildSplitsTable(splits) {
            document.getElementById('townCosts').innerHTML = '';
            for (var i = 0; i < splits.length; i++) {
                buildSplitsRow(splits[i])
            }
        }//build town splits table

        function buildSplitsRow(town) {
            var pct = town.split;
            var name = town.town;

            var townTable = document.getElementById('townCosts');
            var row = townTable.insertRow();
            row.className = 'townRow';
            var tName = row.insertCell(0);
            tName.className = 'tName';
            tName.innerHTML = name;

            var tPct = row.insertCell(1);
            tPct.className = 'townPct';
            var pctInput = document.createElement('input');
            pctInput.setAttribute('value', pct);
            pctInput.style.display = 'none';
            tPct.appendChild(pctInput);
            var pctDisp = document.createElement('span');
            pctDisp.innerHTML = parseInt(pct * 100);
            tPct.appendChild(pctDisp);

            var tCost = row.insertCell(2);
            tCost.className = 'townValue';
        }//build town splits rows

        function calculateTotalCapCost(row) {
            var InitCapCost = $(row).children('.CapCost').children('input').val();
            var CapFinance = $(row).children('.CapFinance').children('select').val();
            var TotalCapCostValue = (InitCapCost !== 'null') ? InitCapCost * CapFinance : 0;
            $(row).children('.TotalCapCost').children('input').val(TotalCapCostValue);
            $(row).children('.TotalCapCost').children('span').html(commas(d3.round(TotalCapCostValue)));
        }//calculate total capital cost per row

        function calculateTotalOMCost(row) {
            var MonitoringCost = parseFloat($(row).children('.Monitoring').children('input').val());
            var startY = parseFloat($(row).children('.Years').children('input.start').val()); 
            var endY = parseFloat($(row).children('.Years').children('input.end').val()); 
            var Years = endY - startY; 
            var OMCost = $(row).children('.TotalOM').children('input').attr('om');
            OMCost = (OMCost == 'null') ? 0 : parseFloat(OMCost);
            //var TotalOMCostValue = MonitoringCost + OMCost;
            var TotalOMCostValue = (MonitoringCost * Years) + OMCost;
            $(row).children('.TotalOM').children('input').val(TotalOMCostValue);
            $(row).children('.TotalOM').children('span').html(commas(d3.round(TotalOMCostValue)));
        }//calculate total OM cost per row

        function calculateTotalTechCost(row) {
            var TotalCap = parseFloat($(row).children('.TotalCapCost').children('input').val());
            var TotalOM = parseFloat($(row).children('.TotalOM').children('input').val());
            var TotalTech = TotalCap + TotalOM;
            $(row).children('.TotalTech').children('input').val(TotalTech);
            $(row).children('.TotalTech').children('span').html(commas(d3.round(TotalTech)));
        }//calculate total technology cost per row

        function updateTotalTechCost(row) {
            var TotalCap = parseFloat(row.children('.TotalCapCost').children('input').val());
            var TotalOM = parseFloat(row.children('.TotalOM').children('input').val());
            var TotalTech = TotalCap + TotalOM;
            row.children('.TotalTech').children('input').val(TotalTech);
            row.children('.TotalTech').children('span').html(commas(d3.round(TotalTech)));
        }//update total technology cost for row

        function updateTotalCapCost(e) {
            var row = $(this).closest('tr');
            var InitCapCost = row.children('.CapCost').children('input').val();
            var CapFinance = $(this).val();
            var TotalCapCostValue = (InitCapCost !== 'null') ? InitCapCost * CapFinance : 0;
            row.children('.TotalCapCost').children('input').val(TotalCapCostValue);
            row.children('.TotalCapCost').children('span').html(commas(d3.round(TotalCapCostValue)));
            updateTotalTechCost(row);
            calculateCostSplits();
        }//update total capital cost for row

        function updateTotalCapCost2(row, index) {
            var InitCapCost = row.children('.CapCost').children('input').val();
            var CapFinance = row.children('.CapFinance').children('select').val();
            var TotalCapCostValue = (InitCapCost !== 'null') ? InitCapCost * CapFinance : 0;
            row.children('.TotalCapCost').children('input').val(TotalCapCostValue);
            row.children('.TotalCapCost').children('span').html(commas(d3.round(TotalCapCostValue)));
            updateTotalTechCost(row);
            calculateCostSplits();
            simIconClick(index);
        }//update total capital cost for row given user input

        function updateTotalOMCost(e) {
            var row = $(this).closest('tr');
            var MonitoringCost = parseFloat(row.children('.Monitoring').children('input').val());
            var startY = parseFloat(row.children('.Years').children('input.start').val()); 
            var endY = parseFloat(row.children('.Years').children('input.end').val()); 
            var Years = endY - startY;//
            var OMCost = row.children('.TotalOM').children('input').attr('om');
            OMCost = (OMCost == 'null') ? 0 : parseFloat(OMCost);
            //var TotalOMCostValue = MonitoringCost + OMCost;
            var TotalOMCostValue = (MonitoringCost * Years) + OMCost;
            row.children('.TotalOM').children('input').val(TotalOMCostValue);
            row.children('.TotalOM').children('span').html(commas(d3.round(TotalOMCostValue)));
            updateTotalTechCost(row);
            calculateCostSplits();
        }//update total OM cost for row

        function updateTotalOMCost2(row,index) {
            var MonitoringCost = parseFloat(row.children('.Monitoring').children('input').val());
            var startY = parseFloat(row.children('.Years').children('input.start').val()); 
            var endY = parseFloat(row.children('.Years').children('input.end').val()); 
            var Years = endY - startY;//
            var OMCost = row.children('.TotalOM').children('input').attr('om');
            OMCost = (OMCost == 'null') ? 0 : parseFloat(OMCost);
            //var TotalOMCostValue = MonitoringCost + OMCost;
            var TotalOMCostValue = (MonitoringCost * Years) + OMCost;
            row.children('.TotalOM').children('input').val(TotalOMCostValue);
            row.children('.TotalOM').children('span').html(commas(d3.round(TotalOMCostValue)));
            updateTotalTechCost(row);
            calculateCostSplits();
            simIconClick(index);
        }//update total OM cost for row given user input

        function calculateCostSplits() {
            var mainTable = document.getElementById('mainTable');
            var rows = mainTable.getElementsByClassName('treatRow');
            var sums = [0, 0, 0, 0, 0];
            for (var i = 0; i < rows.length; i++) {
                var row = rows[i];
                var totalCost = parseFloat($(row).children('.TotalTech').children('input').val());
                data.Treatments[i].Cost = totalCost;
                var whoPays = parseInt($(row).children('.WhoPays').children('select').val());
                sums[whoPays] += totalCost;
                var startY = parseFloat($(row).children('.Years').children('input.start').val());
                var endY = parseFloat($(row).children('.Years').children('input.end').val());
                data.Treatments[i].y1 = startY;
                data.Treatments[i].y2 = endY;
                data.Treatments[i].WhoPays = whoPays;
            }
            var costTable = document.getElementById('totalCosts');
            var costRows = costTable.getElementsByClassName('costRow');
            for (var i = 0; i < costRows.length; i++) {
                var thisCost = costRows[i];
                $(thisCost).children('.cost').children('span').html(commas(d3.round(sums[i], 2)));
                $(thisCost).children('.cost').children('input').val(sums[i]);

                data.Payers[i] = {
                    Payer: $(thisCost).children('.cost')[0].classList[1],
                    Cost: sums[i]
                };
            }
            calculateTownSplits();

            updateCharts(data);

        }//calculate who pays cost splits

        function updateWhoPaysGraph() {

            var index = $('#graphs').find('select').val();
            var affordabilityvalue = $('#graphs').find('input.afford').val();
            var T5replacevalue = $('#graphs').find('input.T5').val();

            var affordsegments = new Array(horizon + 1);
            for (var i = 0; i < affordsegments.length; i++) {
                affordsegments[i] = affordabilityvalue;
            }

            var T5replacesegments = new Array(horizon + 1);
            for (var i = 0; i < T5replacesegments.length; i++) {
                T5replacesegments[i] = T5replacevalue;
            }

            var timeSegments = [new Array(horizon + 1), new Array(horizon + 1), new Array(horizon + 1), new Array(horizon + 1), new Array(horizon + 1), new Array(horizon + 1)];
            
            for (var i = 0; i < timeSegments.length; i++) {
                for (var b = 0; b < timeSegments[i].length; b++) {
                    timeSegments[i][b] = 0;
                };
            };
            for (var i = 0; i < data.Treatments.length; i++) {
                var ds = data.Treatments[i];
                var totalY = ds.y2 - ds.y1;
                var yrCost = ds.Cost / totalY;

                var whoPays = ds.WhoPays;

                for (var y = ds.y1; y < ds.y2 + 1; y++) {
                    timeSegments[whoPays][y] += yrCost;
                    timeSegments[5][y] += yrCost;
                }
            }

            var amongWhom = (index == 0) ? data.Counts.TownsAll : (index == 1) ? data.Counts.InEmbay.TotalParcelsInEmbayment : 1;

            var segMax = d3.max(timeSegments[index]) / amongWhom
            var range = [d3.min(timeSegments[index]) / amongWhom, d3.max([segMax, affordabilityvalue, T5replacevalue]) * 1.25];
            //console.log(range);
            //var range = [d3.min(timeSegments[index]) / amongWhom, d3.max(timeSegments[index]) / amongWhom * 1.25];
            var x = d3.scale.linear().range([margins.left, chartW - margins.right]).domain([0, horizon])
            var y = d3.scale.linear().range([chartH - margins.top, margins.bottom]).domain(range)
            var chartx = d3.scale.linear().domain([margins.left, chartW - margins.right]).range([0, horizon])

            var lineFx = d3.svg.line()
                .x(function (d, i) { return x(i) })
                .y(function (d) { return y(d/amongWhom) })
                .interpolate('linear');

            var affordlineFx = d3.svg.line()
                .x(function (d, i) { return x(i) })
                .y(function (d) { return y(d) })
                .interpolate('linear');

            var T5replacelineFx = d3.svg.line()
                .x(function (d, i) { return x(i) })
                .y(function (d) { return y(d) })
                .interpolate('linear');

            ticks.select(".xaxis")
                .call(xAxis.scale(x));

            ticks.selectAll('.tick').attr('x1', function (d) { return x(d) }).attr('x2', function (d) { return x(d) })
            .attr('y1', margins.top).attr('y2',(250-(margins.top)))


            line.data(timeSegments[index])
                .transition().duration(200).ease('linear')
                .attr('d', lineFx(timeSegments[index])).attr('hh', amongWhom)
                .style('stroke', 'black').style('fill', 'none')



            if (index == 0) {
                d3.selectAll(".townline").style('display', 'block')
                d3.selectAll(".mainline").style('display', 'none')
                var maxHH = data.Towns.sort(function (a, b) { return b.households - a.households })[0].households;
                var segMax = d3.max(timeSegments[index]) / maxHH;
                var range = [d3.min(timeSegments[index]) / amongWhom, d3.max([segMax, affordabilityvalue, T5replacevalue]) * 1.25];

                //var range = [0, d3.max(timeSegments[index]) / maxHH * 1.25];
                y.domain(range);

                for (var i = 0; i < townlines.length; i++) {
                    var percent = data.Towns[i].split;
                    var amongWhom = data.Towns[i].households;
                    var Town = data.Towns[i].town;
                    lineFx.y(function (d) { return y(d * percent/amongWhom) })

                    townlines[i].data(timeSegments[0])
                    .transition().duration(200).ease('linear')
                    .attr('d', lineFx(timeSegments[0])).attr('split',percent).attr('hh',amongWhom).attr('who',Town)
                    .style('stroke', 'black').style('fill', 'none')
                }
            } else {
                d3.selectAll(".townline").style('display','none')
                d3.selectAll(".mainline").style('display','block')
            }

            affordline
                .transition().duration(200).ease('linear')
                .attr('d', affordlineFx(affordsegments))

            T5replaceline
                    .transition().duration(200).ease('linear')
                    .attr('d', T5replacelineFx(T5replacesegments))

                lineGraph.select(".yaxis")
                .call(yAxis.scale(y));

                d3.selectAll(".line").on('mouseover', hover).on('mousemove', hover).on('mouseout', unhover)

           function hover(d) {
               //console.log(d3.event)
               var toolL = (d3.event.offsetX > 350 / 2) ? 'auto' : (d3.event.offsetX + 10) + 'px';
               var toolR = (d3.event.offsetX > 350 / 2) ? (350 - (d3.event.offsetX)) + 'px' : 'auto';
               var toolT = (d3.event.offsetY > 300 / 2) ? 'auto' : (d3.event.offsetY + 10) + 'px';
               var toolB = (d3.event.offsetY > 300 / 2) ? (300 - (d3.event.offsetY)) + 'px' : 'auto';
               tooltip.style('top', toolT).style('bottom', toolB).style('left', toolL).style('right', toolR).style('visibility', 'visible');
                var cx = d3.round(chartx(d3.event.offsetX), 0);
                d3.selectAll(".line").style('opacity', 0.2)
                d3.select(this).style('opacity',1)
                if (index == 0) {
                    var who = d3.select(this).attr('who');
                    var split = d3.select(this).attr('split');
                    var hh = d3.select(this).attr('hh');
                    var value = timeSegments[index][cx] * split / hh;
                }
                else {
                    var hh = d3.select(this).attr('hh');
                    var value = timeSegments[index][cx] / hh;
                    var who = "";
                }

                toolText.text(who + ' year ' + cx + ': $' + commas(d3.round(value, 0)));
                toolIcon.style('display', 'none');
               //d3.select(this).select('title').text(who+' year ' + cx + ': $' + commas(d3.round(value, 0)));
           }

           function unhover() {
               tooltip.style('visibility', 'hidden');
               d3.selectAll(".line").style('opacity', 1)
           }
     
        }

        function calculateTownSplits() {
            var townRows = document.getElementsByClassName('townRow');
            var townCostCell = document.getElementsByClassName('allTowns')[0];
            var townsCost = parseFloat($(townCostCell).children('input').val());
            for (var i = 0; i < townRows.length; i++) {
                var townRow = townRows[i];
                var name = $(townRow).children('.tName').html();
                var pct = parseFloat($(townRow).children('.townPct').children('input').val());
                var split = townsCost * pct;
                $(townRow).children('.townValue').html(commas(d3.round(split, 2)));
                data.Towns[i].Cost = split;
            }
        }//calculate town splits values

        //////----chart init
        var chartW = 350, chartH = 125;
        var chart;
        var margins = { top: 25, bottom: 25, left: 50, right: 50 }
        var rectangles, lineGraph, line, yAxis, xAxis, townlines = [], affordline, ticks, T5replaceline;

        

        function updateCharts(data) {
            rectangles.data(data.Treatments).attr('height', function () {
                return (chartH-margins.top) / data.Treatments.length *0.8;
            })
            .attr('width', function (d) {
                var width = (d.y2 - d.y1) / horizon * (chartW-margins.left-margins.right);
                return width
            })
            .attr('transform', function (d,i) {
                var y = ((chartH - margins.top) / data.Treatments.length * i) + margins.top;
                var x = d.y1 / horizon * (chartW - margins.left - margins.right)+margins.left;
                return 'translate(' + x + ',' + y + ')';
            })
            .style('fill', function (d) { return d.color })

            //rectangles.select('title').text(function (d) { return treatmentStyles[d.name].name });
            rectangles.on('mouseover', recthover).on('mouseout', rectunhover).on('mousemove', recthover)

            function rectunhover(d) {
                tooltip.style('visibility', 'hidden');
                d3.selectAll(".treatment").style("opacity", 1)
                //d3.selectAll(".treatment").style("opacity", 1)
            }

            function recthover(d) {
                toolIcon.attr('src', 'TreatIcons/' + treatmentStyles[d.name].icon).style('display','block')
                var toolL = (d3.event.offsetX > 350 / 2) ? 'auto' : (d3.event.offsetX + 10) + 'px';
                var toolR = (d3.event.offsetX > 350 / 2) ? (350 - (d3.event.offsetX)) + 'px' : 'auto';
                var toolT = (d3.event.offsetY > 300 / 2) ? 'auto' : (d3.event.offsetY + 10) + 'px';
                var toolB = (d3.event.offsetY > 300 / 2) ? (300 - (d3.event.offsetY)) + 'px' : 'auto';
                tooltip.style('top', toolT).style('bottom', toolB).style('left', toolL).style('right', toolR).style('visibility', 'visible');
                toolText.text(treatmentStyles[d.name].name);
            }


            updateWhoPaysGraph();
        }


    });//doc on ready


    </script>

      <style>

            html, body, h1 {
                padding:0;
                margin:0;
                height:100%;
                font-family:Tahoma, Geneva, sans-serif;
                -moz-user-select: none; 
                -khtml-user-select: none; 
                -webkit-user-select: none; 
                -o-user-select: none; 
            }
            input {
                line-height: 1;
                font-family: Tahoma, Geneva, sans-serif;
                font-size: 11px;
            }
            input::-ms-clear {
                display: none;
            }

            input[type=number]::-webkit-inner-spin-button,
            input[type=number]::-webkit-outer-spin-button {
                -webkit-appearance: none;
                margin: 0;
            }
            #scenarioInput-container input[type=number] {
                -moz-appearance:textfield;
                border: none;
                vertical-align:middle;
                float:left;
                font-size: 14px;
                line-height: 15px;
                padding-top: 16px;
                padding-left:10px;
                padding:16px;
                padding-right:10px;
                color: #444;
                background: none;
                width: 145px;
                display:inline-block;
            }
            input:focus{
                outline:none;
            }

          table{
              margin-top:20px;
              border-collapse:collapse;
              vertical-align:middle;
          }
          td{
              padding:3px;
              min-height:30px;
              border:1px solid black;
          }
            #app-container,#money {
                position: absolute;
                height: 300px;
                width:350px;
                left:20px;
                top: 20px;
                border-radius: 10px;
            }
          #money {
                background:url("images/dollars.jpg");
          }
          #app-container {
                border:3px solid;
                border-color:gray;
                background-color:rgba(255,255,255,0.96);
          }
            .center {
                text-align:left;
                margin-left: auto;
                margin-right: auto; 
                width:575px;
            }
            #scenarioInput-container {
                border:2px solid gray;
                position:relative;
                margin:100px auto;
                width:165px;
                height:50px;
                background-color:white;
                z-index:0;
            }
            #submitter {
                float:left;
                width:14px;
                height:14px;
                margin-top:16px;
                background-color:none;
                background-image: url("images/search.png");
                background-repeat:no-repeat;
                cursor:pointer;
            }
            #submitter:hover {
                
                background-image: url("images/search_hov.png");
            }

            #scenarioIcons{
                position:absolute;
                top:0;left:0;
                height:295px;
                width:60px;
                border:0px solid black;
                overflow-y:hidden;
                overflow-x:hidden;
            }
            .scenarioIcon{
                display:inline-block;
                height:50px;
                width:50px;
                margin:2.5px 5px;
                background-size:cover;
                cursor:pointer;
                border-radius:100%;
                border:2px solid gray;
            }
            .scenarioIcon.active{
                border:2px solid black;
            }
            #treatmentInputs{
                position:absolute;
                top:0;
                left:60px;
                width:290px;
                height:300px;
                border:0px solid black;
            }
            #treatmentInputs td,#treatmentInputs p,#treatmentInputs select,.graphTable td,.graphTable select{
                margin:0;
                padding-left:5px;
                font-size:12px;
                color:black;
                font-family:Tahoma, Geneva, sans-serif;
            }
          .graphTable {
                position:absolute;
                bottom:5px;
                left:20px;
          }
          .graphTable td {
              padding-top:2px;
              padding-bottom:2px;
          }
          .graphTable 
            .innerTable,.graphTable{
                margin-top:0;
            }
            .cellT{
                text-align:right;
            }
            .cellV{
                width:150px;
            }
            .innerTable .cellV .slider{
                height:10px;
                vertical-align:middle;
            }
            .innerTable td,.graphTable td{
                border:0px solid black;
            }
            #treatmentInputs .name{
                font-size:16px;
                margin-top:5px;
                text-align:center;
                padding-left:0px;
            }
            #treatmentInputs .years{
                width:30px;
            }
            #treatmentInputs .mon{
                width:60px;
            }
            #treatmentInputs select{
                border:1px solid gray;
                width:155px;
            }
            #buttons{
                position:absolute;
                bottom:5px;right:5px;
                display:none;
                width:36px;
            }
            .showButton{
                width:0;
                height:0;
                border-top:10px solid transparent;
                border-bottom:10px solid transparent;
                cursor:pointer;
            }
          .ui-slider .ui-slider-handle {
                font-size:10px;
                height:14px;
                width:14px;
                padding-bottom:2px;
                text-align:center;
          }
          .scroll{
            position:absolute;
            right:0px;
            width: 0; 
            height: 0; 
            border-left: 6px solid transparent;
            border-right: 6px solid transparent;
          }
          .scroll.down{
            bottom:2px;
            border-top: 8px solid gray;
          }
        .scroll.up{
            top:2px;
            border-bottom: 8px solid gray;
          }
        #graphs,#treatmentInput-container{
            display:none;
            position:absolute;
            height:300px;
        }
        .yaxis path{
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
          .xaxis path {
              stroke: none;
              fill:none;
          }
          .xaxis text {
              background-color: rgba(255,255,255,0.5);
          }
          .line {
          stroke-width: 3px;
          }
          .affordline {
          stroke-width: 2px;
          stroke-dasharray:5px 2px;
          }
          .T5replaceline {
          stroke-width: 2px;
          stroke-dasharray:5px 2px;
          }
          input.afford {
              border-color: red;
          }
          input.T5 {
              border-color: blue;
          }
          .yaxis, .xaxis {
          font-size:12px;
          }
          .graphSelect option{
          vertical-align:top
          }
          #scenarioInfo {
          position:absolute;
          bottom:10px;
          left:65px;
          width:245px;
          font-size:14px;
          }
          #home-container h1{
            position:absolute;
            top:25px;
            width:100%;
            text-align:center;
          }
          .tooltip{
            line-height:50px;
            vertical-align:middle;
            max-height:50px;
            max-width:200px;
            background-color:rgba(255,255,255,1);
            padding:2px;
            border-radius: 5px
        }
          .toolText {
              line-height:12px;
              /*height:45px;*/
              min-width:140px;
              font-size:14px;
          }
          .toolIcon {
              height:45px;
              width:45px;
              float:left;
              margin-right:3px;
          }

      </style>
  </head>
  <body>
      <div id="money"></div>
      <div id="app-container">
          <div id="home-container" class="container showing">
              <h1>Financial Model</h1>
          <div id="scenarioInput-container">       
              <input id="userInput" type="number" placeholder="Enter a scenario ID"/><div id="submitter"></div>
          </div>
        </div>
          <div id="treatmentInput-container" class="container">
              <div id="scenarioIcons"></div>
              <div id="treatmentInputs"></div>
              <div id="scenarioInfo"></div>
         </div>
         <div id="graphs" class="container"></div>


              <div id="buttons">
                  <div id="leftBtn" class="showButton" style="border-right:16px solid gray;float:left;"></div>
                  <div id="rightBtn" class="showButton" style="border-left:16px solid gray;float:right;"></div>
              </div>

          </div>
      <div style="position:absolute;top:650px;left:20px">
          <table id="mainTable"></table>
          <table id="totalCosts"></table>
          <table id="townCosts"></table>
      </div>

      <!--<script>
          //var NLoadBars = chart.append('g').attr('class', 'NLoad').attr('transform', 'translate(' + margins.left + ','+margins.top+')');
          //var TreatCostBars = chart.append('g').attr('class', 'TreatCost').attr('transform', 'translate(' + (2*margins.left+20) + ',' + margins.top + ')');
          //var WhoPaysBars = chart.append('g').attr('class', 'WhoPays').attr('transform', 'translate(' + (3 * margins.left + 40) + ',' + margins.top + ')');;
          //var TownSplitBars = chart.append('g').attr('class', 'TownSplit').attr('transform', 'translate(' + (4 * margins.left + 60) + ',' + margins.top + ')');;

          //function updateCharts(data) {
          //    var NLoadMax = 0;
          //    var treatCostMax = 0;
          //    for (var i = 0; i < data.Treatments.length; i++) {
          //        NLoadMax += data.Treatments[i].NReduction;
          //        treatCostMax += data.Treatments[i].Cost
          //    }
          //    var townCostMax = 0
          //    for (var i=0;i<data.Towns.length;i++){
          //        townCostMax += data.Towns[i].Cost;
          //    }
          //    var whoPaysMax = treatCostMax;

          //    var n = NLoadBars.selectAll('rect').data(data.Treatments.filter(function(a){return a.NReduction > 0}));
          //    n.enter().append('rect').attr('width', 50).style('stroke', 'black').style('fill', 'white')
          //    n.attr('height', function (d) {
          //            var val = d.NReduction/NLoadMax;
          //            var maxH = 500 - margins.top - margins.bottom;
          //            var barH = maxH * val;
          //            return barH;
          //        })
          //        .attr('transform', function (d, i) {
          //            var maxH = 500 - margins.top - margins.bottom;
          //            var offset = 0;
          //            var num = 0;
          //            for (var b = 0; b < i; b++) {
          //                num += data.Treatments[b].NReduction;
          //            }
          //            offset += num / NLoadMax * maxH;
          //            return 'translate(0,'+offset+')';
          //        })
          //    n.exit().remove();

          //    var treat = TreatCostBars.selectAll('rect').data(data.Treatments.filter(function (a) { return a.Cost > 0 }));
          //    treat.enter().append('rect').attr('width', 50).style('stroke', 'black').style('fill', 'white')
          //        .attr('height', function (d) {
          //            var val = d.Cost / treatCostMax;
          //            var maxH = 500 - margins.top - margins.bottom;
          //            var barH = maxH * val;
          //            return barH;
          //        })
          //        .attr('transform', function (d, i) {
          //            var maxH = 500 - margins.top - margins.bottom;
          //            var offset = 0;
          //            var num = 0;
          //            for (var b = 0; b < i; b++) {
          //                num += data.Treatments[b].Cost;
          //            }
          //            offset += num / treatCostMax * maxH;
          //            return 'translate(0,' + offset + ')';
          //        })
          //    treat.exit().remove();

          //    var w = WhoPaysBars.selectAll('rect').data(data.Payers.filter(function (a) { return a.Cost > 0 }));
          //    w.enter().append('rect').attr('width', 50).style('stroke', 'black').style('fill', 'white')
          //    w.attr('height', function (d) {
          //            var val = d.Cost / whoPaysMax;
          //            var maxH = 500 - margins.top - margins.bottom;
          //            var barH = maxH * val;
          //            return barH;
          //        })
          //        .attr('transform', function (d, i) {
          //            var maxH = 500 - margins.top - margins.bottom;
          //            var offset = 0;
          //            var num = 0;
          //            for (var b = 0; b < i; b++) {
          //                num += data.Payers[b].Cost;
          //            }
          //            offset += num / whoPaysMax * maxH;
          //            return 'translate(0,' + offset + ')';
          //        })
          //    w.exit().remove();

          //    var town = TownSplitBars.selectAll('rect').data(data.Towns.filter(function (a) { return a.Cost > 0 }));
          //    town.enter().append('rect').attr('width', 50).style('stroke', 'black').style('fill', 'white')
          //    town.attr('height', function (d) {
          //        var val = d.Cost / townCostMax;
          //        var maxH = 500 - margins.top - margins.bottom;
          //        var barH = maxH * val;
          //        return barH;
          //    })
          //    .attr('transform', function (d, i) {
          //        var maxH = 500 - margins.top - margins.bottom;
          //        var offset = 0;
          //        var num = 0;
          //        for (var b = 0; b < i; b++) {
          //            num += data.Towns[b].Cost;
          //        }
          //        offset += num / townCostMax * maxH;
          //        return 'translate(0,' + offset + ')';
          //    })
          //    town.exit().remove();

          //    for (var i = 0; i < data.Towns.length; i++) {
          //        var town = data.Towns[i];
          //        town.hhCost = town.Cost / town.households;
          //    }

          //    //based on built parcels or total parcels?
          //    //var inSubCost = data.Payers[1].Cost / data.Counts.InEmbay.TotalParcelsInSubem;//total
          //    //var inEmbCost = data.Payers[1].Cost / data.Counts.InEmbay.TotalParcelsInEmbayment;//total
          //    var inSubCost = data.Payers[1].Cost / data.Counts.InEmbay.TotalParcelsWWF;//built
          //    var inEmbCost = data.Payers[1].Cost / data.Counts.InSub.SubParcelsWWF;//built

          //    data.embayCosts = { perSubHH: inSubCost, perEmbHH: inEmbCost };

          // }</script>-->
  </body>
</html>
